/**
 * Event Search controller
 * 
 */
function EventSearchCtrl($scope, apiService, apiUrl, $anchorScroll, $location,
		$localStorage, $modal) {

	var _this = this;

	this.selected = {};

	this.eventSearch = function() {

		
		// Create the http post request
		// the data holds the keywords
		// The request is a JSON request.
		var args = {};
		angular.copy(_this.selected, args);
		args['fromDate'] = new Date(this.fromDate).getTime();
		args['toDate'] = new Date(this.toDate).getTime();

		$scope.$emit('populateSearchResults', args);

	};

	this.init = function() {

		var searchArgs = ($localStorage.searchFilterArgs != undefined) ? $localStorage.searchFilterArgs
				: {};
		_this.selected['sessionId'] = (searchArgs['sessionId'] != undefined ? searchArgs['sessionId']
				: '');
		_this.selected['serverId'] = (searchArgs['serverId'] != undefined ? searchArgs['serverId']
				: '');
		_this.selected['source'] = (searchArgs['source'] != undefined ? searchArgs['source']
				: '');
		_this.selected['domainId'] = (searchArgs['domainId'] != undefined ? searchArgs['domainId']
				: '');

		_this.fromDate = (searchArgs['fromDate'] != undefined ? searchArgs['fromDate']
				: new Date());

		_this.toDate = (searchArgs['toDate'] != undefined ? searchArgs['toDate']
				: new Date());

		_this.getSources();
		_this.getDomains();
		_this.getServers();
		_this.getSessions();

	}

	/*
	 * Get all Session Ids
	 */

	this.getSessions = function() {
		var args = {};
		angular.copy(_this.selected, args);
		args['sessionId'] = "";
		apiService.getWithParams(apiUrl.GET_SESSIONS, args, function(
				data, status) {
			_this.eventSessionList = data.names;

		});
	}

	this.hasSessionChanged = function() {
		_this.getServers();
		_this.getDomains();
		_this.getSources();
	}

	/*
	 * Get all Server Ids
	 */

	this.getServers = function() {
		var args = {};
		angular.copy(_this.selected, args);
		args['serverId'] = "";
		apiService.getWithParams(apiUrl.GET_SERVERS, args, function(
				data, status) {
			_this.eventServerList = data.names;
		});
	}

	this.hasServerChanged = function() {

		_this.getSessions();
		_this.getDomains();
		_this.getSources();
	}

	/*
	 * Get all Domain Ids
	 */

	this.getDomains = function() {
		var args = {};
		angular.copy(_this.selected, args);
		args['domainId'] = "";
		apiService.getWithParams(apiUrl.GET_DOMAINS, args, function(
				data, status) {
			_this.eventDomainList = data.names;
		});
	}

	this.hasDomainChanged = function() {

		_this.getSessions();
		_this.getServers();
		_this.getSources();
	}

	/*
	 * Get all Domain Ids
	 */

	this.getSources = function() {
		var args = {};
		angular.copy(_this.selected, args);
		args['source'] = "";
		apiService.getWithParams(apiUrl.GET_SOURCES, args, function(
				data, status) {
			_this.eventSourceList = data.names;
		});
	}

	this.hasSourceChanged = function() {

		_this.getSessions();
		_this.getServers();
		_this.getDomains();
	}

	this.init();

}

/**
 * 
 * Pass all functions into module
 */
angular.module('cie').controller('EventSearchCtrl', EventSearchCtrl)
