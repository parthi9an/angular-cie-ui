/**
 * MainCtrl - controller Contains severals global data used in diferent view
 * 
 */
function MainCtrl(conf, apiUrl, apiService, $scope, $http, $anchorScroll,
		$location, $localStorage, $modal, $compile) {
	var _this = this;
	
	this.patternData = [ {
		"pattern" : "#12:4_#21:3",
		"pattern_class" : "Action_KeyB",
		"association_count" : 6
	}, {
		"pattern" : "#12:5_#26:1_#36:2",
		"pattern_class" : "Action_View_Window",
		"association_count" : 2
	}, {
		"pattern" : "#12:5_#26:1_#36:2_#25:2_#32:5_#19:9_#73:7",
		"pattern_class" : "Action_View_Window_View_KeyB_Config_Environment",
		"association_count" : 1
	} ];

	/**
	 * Pie chart
	 */
	var pieCustomData = [ 52, 12, 44, 22, 34, 77, 99 ];
	var pieCustomOptions = {
		type : 'pie',
		height : '150px',
		sliceColors : [ '#1ab394', '#b3b3b3', '#e4f0fb', '#1ac394', '#b3a3b3',
				'#e5f0fb', '#b3a3a3' ]
	};

	this.getFrequentEventPattern = function(args) {

		apiService.getWithParams(apiUrl.GET_FREQUENT_EVENT_PATTERN, args,
				function(data, status) {

					for (var i = 0; i < data.length; i++) {
						data[i].eIds = data[i].pattern.replace(/#/g, '').split(
								'_');
						data[i].eNames = data[i].pattern_class.split('_');
					}
					_this.patternData = data;
				});
		/*
		data = [ {
			"pattern" : "#12:4_#21:3",
			"pattern_class" : "Action_KeyB",
			"association_count" : 6
		}, {
			"pattern" : "#12:5_#26:1_#36:2",
			"pattern_class" : "Action_View_Window",
			"association_count" : 2
		}, {
			"pattern" : "#12:5_#26:1_#36:2_#25:2_#32:5_#19:9_#73:7",
			"pattern_class" : "Action_View_Window_View_KeyB_Config_Environment",
			"association_count" : 1
		} ];

		for (var i = 0; i < data.length; i++) {
			data[i].eIds = data[i].id.replace(/#/g, '').split('_');
			data[i].eNames = data[i].name.split('_');
			console.log(data[i]);
		}
		_this.patternData = data;
//		if($scope.selPatternIndex != index) {
//			$('*[class^="elements"]').toggle();
//		}
*/
	}
	this.tooglePattern = function(index, e, event) {
		var el = e.replace(':', '_');
		$("#pattern" + index + "" + el).find('.elements').toggle();
		if ($("#pattern" + index + "" + el).find('.elements').is(":visible")) {
			this.loadPatternElements(index, el);
		}
		return false;
	}

	this.loadPatternElements = function(index, id) {
		var args = [];
		args['rid'] = id.replace('_', ':');
		/*
		 * apiService.getWithParams(apiUrl.GET_EVENT_DETAIL, args, function(
		 * data, status) { var el = id.split(':')[1]; var element = $("#pattern" +
		 * el).find('.elements'); element.html('');
		 * 
		 * for (i = 0, x = data.results.length; i < x; i++) { element.append('<div>' +
		 * data.results[i].value + ' - <span >' + data.results[i].count + '</span>
		 * </div>') } });
		 */

		var element = $("#pattern" + index + "" + id).find('.elements');
		element.html('');

//		element.append("<table style='width:100%' class=''>");
//		var data = {
//			"action_key" : "common.action.delete",
//			"action_command" : "toolbar",
//			"action_view" : "SQL Script"
//		};
//		for ( var key in data) {
//			element.append("<tr><td> " + key + "</td><td>" + data[key]
//					+ "</td></tr>");
//		}
//		element.append("</table>");
		
		apiService.getWithParams(apiUrl.GET_EVENT_DETAIL, args,
				function(data, status) {
					element.append("<table style='width:100%' class=''>");
					for ( var key in data) {
					element.append("<tr><td>" + key + "</td><td>  " + data[key]
							+ "</td></tr>");
					}
				element.append("</table>");

				});
		

	}

	this.getFrequentEventPattern('');

}

angular.module('cie').controller('MainCtrl', MainCtrl);

angular.module('cie').filter("removeClusterInfo", function() {
	return function(data) {
		return data.replace(':', '_');
	};
});
