/**
 * User Controller 
 */

function UserCtrl(conf, apiUrl, apiService, $scope, $http,
		$localStorage, $modal, $compile) {

	var _this = this;
	
	this.init = function() {

		var args = ($localStorage.searchFilterArgs != undefined) ? $localStorage.searchFilterArgs
				: {};
		//_this.getCountOfLoginUser(args);	
		_this.getCountOfUsers(args);
		_this.getCountOfSessions(args);
	}
	
	$scope.$on('populateSearchResults', function(event, args) {

		$localStorage.searchFilterArgs = args;
		//_this.getCountOfLoginUser(args);	
		_this.getCountOfUsers(args);
		_this.getCountOfSessions(args);
	});

	/* how many users login via LDAP, composite, or dynamic domains.
	 * Pie chart
	 */
	
	this.getCountOfLoginUser = function(args) {
		apiService.getWithParams(apiUrl.GET_COUNT_OF_LOGIN_USER, args,
				function(data, status) {
					_this.loginUserData = data;
				});
	}
	
	/*
	 * Get  
	 * Pie chart
	 */
	
	this.getCountOfUsers = function(args) {
		apiService.getWithParams(apiUrl.GET_COUNT_OF_USERS, args,
				function(data, status) {
					_this.userData = data;
				});
	}
	
	/*
	 *  Pie chart of user session counts per site. 
	 *    Maybe we can drill down from this to list the user sessions
	 */
	this.getCountOfSessions = function(args) {
		apiService.getWithParams(apiUrl.GET_COUNT_OF_SESSIONS, args,
				function(data, status) {
					_this.userSessionData = data;
				});
	}
	
	this.init();
	
}

/**
 * 
 * Pass all functions into module
 */

angular.module('cie').controller('UserCtrl', UserCtrl);