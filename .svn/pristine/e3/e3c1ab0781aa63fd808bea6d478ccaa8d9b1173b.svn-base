/**
 * 
 */

function ToolErrorEventCtrl(conf, apiUrl, apiService, $scope, $http,
		$localStorage, $modal, $compile) {

	var _this = this;
	
//	this.errorData = [{"id" : "12:4", "name": "NullPointerException", "count":  6},
//	                  {"id" : "12:5", "name": "ClassNotFoundException", "count":  2}];

	/**
	 * Pie chart
	 */

	$scope.$on('populateSearchResults', function(event, args) {

		$localStorage.searchFilterArgs = args;
		_this.getExceptionCount(args);
	});

	this.getFrequentExceptionPattern = function(index, e, event) {
		var args = [];
		args['errorType'] = e;
		apiService.getWithParams(apiUrl.GET_FREQUENT_EXCEPTION_PATTERN, args,
				function(data, status) {

					for (var i = 0; i < data.length; i++) {
						data[i].eIds = data[i].pattern.replace(/#/g, '').split(
								'_');
						data[i].eNames = data[i].pattern_class.split('_');
					}
				
					
					$("#excep" + index).find('.elements').toggle();
					if ($("#excep" + index).find('.elements').is(":visible")) {
						//_this.loadPatternElements(index, _this.exceptionPatternData);
						_this.exceptionPatternData = data;
					}
				});

		return false;
	}

	this.loadPatternElements = function(index, excepData) {
		
		var element = $("#excep" + index ).find('.elements');
		element.html('');
		
		for ( var i in excepData) {
			element.append("<ul class='tag-list' style='padding: 0'>");			
			for ( var j in excepData[i].eNames) {
				element.append("<li> <b><a href=''>" + excepData[i].eNames[j] + "</a></b></li> ");
			}
			element.append("</ul>");
		}
		
	}
	this.getExceptionCount = function(args) {
		apiService.getWithParams(apiUrl.GET_EXCEPTION_COUNT, args, function(
				data, status) {
			_this.exceptionData = data;
		});
	}

	this.getExceptionCount('');

}

/**
 * 
 * Pass all functions into module
 */

angular.module('cie').controller('ToolErrorEventCtrl', ToolErrorEventCtrl);