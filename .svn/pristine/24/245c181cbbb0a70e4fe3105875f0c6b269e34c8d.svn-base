'use strict';
 
angular.module('cie')
 
.factory('AuthenticationService',
    ['$http', '$cookieStore', '$rootScope', '$timeout', 'apiUrl', 'conf', 
    function ($http, $cookieStore, $rootScope, $timeout, apiUrl, conf) {
        var service = {};

        service.Login = function (username, password, callback) {
                     
           /*  ----------------------------------------------*/
            $timeout(function(){
            	$http.post( conf.apiBaseUrl + '/' + apiUrl.LOGIN, { uName: username, password: password })
                .success(function (response, status, headers, config) {
                	if(response.status != "Success") {
                        response.message = 'Username or password is incorrect';
                    } else {
                    	response['success'] = true;
                    	response['Access-Token'] = headers('Access-Token');
                    }
                    callback(response);
                });
            	
            }, 1000);

        };
 
        service.SetCredentials = function (username, token) {
        
            $rootScope.globals = {
                currentUser: {
                    username: username,
                    authdata: token
                }
            };
 
            $http.defaults.headers.common['Access-Token'] = token;
            $cookieStore.put('globals', $rootScope.globals);
        };
 
        service.ClearCredentials = function () {
            $rootScope.globals = {};
            $cookieStore.remove('globals');
            $http.defaults.headers.common['Access-Token'] = '';
        };
 
        return service;
    }])

.factory('userDataService', ['$rootScope', function($rootScope) {
    	return {
    		getUserName: function() {
    		    return (!angular.equals({}, $rootScope.globals)) ? $rootScope.globals.currentUser.username
    					: "Unknown";;
    		},
    	};
}]);
 
